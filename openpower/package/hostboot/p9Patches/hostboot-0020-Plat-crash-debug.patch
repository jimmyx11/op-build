From 9297fd62d9f72076b6473199d4658d14be237022 Mon Sep 17 00:00:00 2001
From: Bill Hoffa <wghoffa@us.ibm.com>
Date: Wed, 8 Feb 2017 10:45:15 -0600
Subject: [PATCH] Plat crash debug

Change-Id: Iacdadea1054f216acbe19feaa5f5b6cc7ca8d95c
---
 src/usr/hwas/hwasPlat.C | 19 ++++++++++++++++---
 1 file changed, 16 insertions(+), 3 deletions(-)

diff --git a/src/usr/hwas/hwasPlat.C b/src/usr/hwas/hwasPlat.C
index 63068b6..a77b3ed 100644
--- a/src/usr/hwas/hwasPlat.C
+++ b/src/usr/hwas/hwasPlat.C
@@ -431,6 +431,9 @@ errlHndl_t platPresenceDetect(TargetHandleList &io_targets)
             errlCommit(errl, HWAS_COMP_ID);
         }
 #endif
+
+#if 0
+
 #if    defined(CONFIG_MEMVPD_WRITE_TO_PNOR) || \
        defined(CONFIG_PVPD_WRITE_TO_PNOR)
         errl = PNOR::clearSection( PNOR::CENTAUR_VPD );
@@ -440,6 +443,8 @@ errlHndl_t platPresenceDetect(TargetHandleList &io_targets)
             errlCommit(errl, HWAS_COMP_ID);
         }
 #endif
+
+#endif
     }
 #endif
 
@@ -449,14 +454,18 @@ errlHndl_t platPresenceDetect(TargetHandleList &io_targets)
             pTarget_it != io_targets.end();
             ) // increment will be done in the loop below
     {
+
         TargetHandle_t pTarget = *pTarget_it;
 
+        HWAS_DBG("pTarget %.8X, determining if present",
+                pTarget->getAttr<ATTR_HUID>());
+
         // if CLASS_ENC
         // by definition, hostboot only has 1 node/enclosure, and we're
         //  here, so it is functional
         if (pTarget->getAttr<ATTR_CLASS>() == CLASS_ENC)
         {
-            HWAS_DBG("pTarget %.8X - detected present",
+            HWAS_DBG("pTarget %.8X - detected present, CLASS_ENC",
                 pTarget->getAttr<ATTR_HUID>());
 
         // If there is planar VPD, then don't skip the presence detect.
@@ -474,7 +483,7 @@ errlHndl_t platPresenceDetect(TargetHandleList &io_targets)
         //  by default
         if (pTarget->getAttr<ATTR_TYPE>() == TYPE_SP)
         {
-            HWAS_DBG("pTarget %.8X - detected present",
+            HWAS_DBG("pTarget %.8X - detected present, TYPE_SP",
                 pTarget->getAttr<ATTR_HUID>());
             pTarget_it++;
             continue;
@@ -483,9 +492,13 @@ errlHndl_t platPresenceDetect(TargetHandleList &io_targets)
         // call deviceRead() to see if they are present
         bool present = false;
         size_t presentSize = sizeof(present);
+        HWAS_DBG("pTarget %.8X - deviceRead with size %lx",
+                  pTarget->getAttr<ATTR_HUID>(), presentSize);
         errl = deviceRead(pTarget, &present, presentSize,
                                 DEVICE_PRESENT_ADDRESS());
 
+         HWAS_DBG("deviceRead complete");
+
         if (unlikely(errl != NULL))
         {   // errl was set - this is an error condition.
             HWAS_ERR( "pTarget %.8X - failed presence detect",
@@ -501,7 +514,7 @@ errlHndl_t platPresenceDetect(TargetHandleList &io_targets)
 
         if (present == true)
         {
-            HWAS_DBG( "pTarget %.8X - detected present",
+            HWAS_DBG( "pTarget %.8X - detected present, present == true",
                 pTarget->getAttr<ATTR_HUID>());
 
             // advance to next entry in the list
-- 
1.8.2.2

